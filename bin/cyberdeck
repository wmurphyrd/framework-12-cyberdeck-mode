#!/usr/bin/env bash
STATE_FILE="/tmp/cyberdeck-state"
enable() {
  kscreen-doctor output.eDP-1.disable;
  sudo framework_tool --tablet-mode laptop;
  sudo framework_tool --touchscreen-enable false;
  echo 1 > "$STATE_FILE";
  echo "cyberdeck mode enabled";
}
disable() {
  kscreen-doctor output.eDP-1.enable;
  sudo framework_tool --tablet-mode auto;
  sudo framework_tool --touchscreen-enable true;
  echo 0 > "$STATE_FILE";
  echo "Cyberdeck mode disabled";
}

if [[ "$1" == "on" ]]; then
  enable
elif [[ "$1" == "off" ]]; then
  disable
else
  if [ -f "$STATE_FILE" ]; then
    ENABLED=$(<"$STATE_FILE")
  else
    ENABLED="0"
  fi
  if [[ "$ENABLED" == "1" ]]; then
    disable
  else
    enable
  fi
fi
